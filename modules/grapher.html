<!DOCTYPE html><html lang="en"><head><title>modules/grapher</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="modules/grapher"><meta name="groc-project-path" content="modules/grapher.js"><meta name="groc-github-url" content="https://github.com/ayasdi/grapher"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/ayasdi/grapher/blob/master/modules/grapher.js">modules/grapher.js</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>Ayasdi Inc. Copyright 2014
Grapher.js may be freely distributed under the Apache 2.0 license</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Grapher: WebGL network graph rendering with PIXI</p></div></div><div class="code"><div class="wrapper"><span class="kd">function</span> <span class="nx">Grapher</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Helpers</p></div></div><div class="code"><div class="wrapper"><span class="kd">var</span> <span class="nx">PIXI</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./vendor/pixi.js&#39;</span><span class="p">),</span>
    <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jashkenas/underscore@1.6.0&#39;</span><span class="p">),</span>
    <span class="nx">Color</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./color.js&#39;</span><span class="p">),</span>
    <span class="nx">pixelRes</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">devicePixelRatio</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">?</span> <span class="nx">devicePixelRatio</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">noop</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{};</span>

<span class="nx">PIXI</span><span class="p">.</span><span class="nx">dontSayHello</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Static</p></div></div><div class="code"><div class="wrapper"><span class="kd">var</span> <span class="nx">NODES</span> <span class="o">=</span> <span class="nx">Grapher</span><span class="p">.</span><span class="nx">NODES</span> <span class="o">=</span> <span class="s1">&#39;nodes&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">LINKS</span> <span class="o">=</span> <span class="nx">Grapher</span><span class="p">.</span><span class="nx">LINKS</span> <span class="o">=</span> <span class="s1">&#39;links&#39;</span><span class="p">;</span>
<span class="nx">Grapher</span><span class="p">.</span><span class="nx">palettes</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// store palettes and textures staticly</span>
<span class="nx">Grapher</span><span class="p">.</span><span class="nx">textures</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">Grapher</span><span class="p">.</span><span class="nx">textures</span><span class="p">[</span><span class="nx">NODES</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">Grapher</span><span class="p">.</span><span class="nx">textures</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">Grapher</span><span class="p">.</span><span class="nx">getPalette</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">palettes</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span> <span class="p">};</span>

<span class="nx">Grapher</span><span class="p">.</span><span class="nx">setPalette</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">swatches</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">palette</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">palettes</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">swatches</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">swatches</span><span class="p">,</span> <span class="nx">Color</span><span class="p">.</span><span class="nx">parse</span><span class="p">);</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">swatches</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">swatch</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getTexture</span><span class="p">(</span><span class="nx">LINKS</span><span class="p">,</span> <span class="nx">swatch</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getTexture</span><span class="p">(</span><span class="nx">NODES</span><span class="p">,</span> <span class="nx">swatch</span><span class="p">);</span>
    <span class="nx">palette</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">swatch</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">j</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">i</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// interpolate &#39;in-between&#39; link colors 50% between node colors</span>
      <span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="nx">Color</span><span class="p">.</span><span class="nx">interpolate</span><span class="p">(</span><span class="nx">swatches</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">swatch</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">getTexture</span><span class="p">(</span><span class="nx">LINKS</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>
      <span class="nx">palette</span><span class="p">[</span><span class="nx">j</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Grapher</span><span class="p">.</span><span class="nx">getTexture</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">textures</span><span class="p">[</span><span class="nx">type</span><span class="p">][</span><span class="nx">color</span><span class="p">])</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>generate the textures from Canvas</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">isNode</span> <span class="o">=</span> <span class="nx">type</span> <span class="o">===</span> <span class="nx">NODES</span><span class="p">,</span>
        <span class="nx">size</span> <span class="o">=</span> <span class="nx">isNode</span> <span class="o">?</span> <span class="mi">100</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">CanvasRenderer</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="p">{</span><span class="nx">transparent</span><span class="o">:</span> <span class="nx">isNode</span><span class="p">,</span> <span class="nx">resolution</span><span class="o">:</span> <span class="nx">pixelRes</span><span class="p">}),</span>
        <span class="nx">stage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">Stage</span><span class="p">(</span><span class="nx">color</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">isNode</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">graphics</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">Graphics</span><span class="p">();</span>
      <span class="nx">graphics</span><span class="p">.</span><span class="nx">beginFill</span><span class="p">(</span><span class="nx">color</span><span class="p">);</span>
      <span class="nx">graphics</span><span class="p">.</span><span class="nx">drawCircle</span><span class="p">(</span><span class="nx">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
      <span class="nx">graphics</span><span class="p">.</span><span class="nx">endFill</span><span class="p">();</span>

      <span class="nx">stage</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">graphics</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">textures</span><span class="p">[</span><span class="nx">type</span><span class="p">][</span><span class="nx">color</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">Texture</span><span class="p">.</span><span class="nx">fromCanvas</span><span class="p">(</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">view</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">textures</span><span class="p">[</span><span class="nx">type</span><span class="p">][</span><span class="nx">color</span><span class="p">];</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Grapher instances</p></div></div><div class="code"><div class="wrapper"><span class="nx">Grapher</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">_lineWidth</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="nx">_foregroundColor</span><span class="o">:</span> <span class="mh">0x222222</span><span class="p">,</span>
  <span class="nx">_backgroundColor</span><span class="o">:</span> <span class="mh">0xffffff</span><span class="p">,</span>

  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Extend default options</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
      <span class="nx">antialias</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">resolution</span><span class="o">:</span> <span class="nx">pixelRes</span>
    <span class="p">},</span> <span class="nx">o</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Renderer and view</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span> <span class="o">=</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">autoDetectRenderer</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">view</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">view</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Stage and containers</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">stage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">Stage</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">network</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">DisplayObjectContainer</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>SpriteBatch containers</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">batches</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">batches</span><span class="p">[</span><span class="nx">NODES</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">batches</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Sprite array</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">[</span><span class="nx">NODES</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>indices that will update</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">willUpdate</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateAll</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_clearUpdateQueue</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Listeners</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">NODES</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set initial transform</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Bind some updaters</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">_updateLink</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_updateLink</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_updateNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_updateNode</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>ex. grapher.on('mouseover', function () {...});</p></div></div><div class="code"><div class="wrapper">  <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">type</span><span class="p">][</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">off</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">type</span><span class="p">])</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">type</span><span class="p">][</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="nx">noop</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">palette</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_palette</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_palette</span> <span class="o">=</span> <span class="nx">Grapher</span><span class="p">.</span><span class="nx">getPalette</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Accepts network data in the form:
{
  nodes: [{x: 0, y: 0, r: 20, color: (swatch or hex/rgb)}, ... ].
  links: [{from: 0, to: 1, color: (swatch or hex/rgb)}, ... ]</p></div></div><div class="code"><div class="wrapper">  <span class="c1">// </span>
  <span class="nx">data</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">exit</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">enter</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">enter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">(),</span>
        <span class="nx">entering</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">].</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span>
        <span class="nx">entering</span> <span class="o">=</span> <span class="nx">entering</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">].</span><span class="nx">slice</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">].</span><span class="nx">length</span><span class="p">,</span> <span class="nx">data</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="k">this</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">].</span><span class="nx">length</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">NODES</span><span class="p">].</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">[</span><span class="nx">NODES</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span>
        <span class="nx">entering</span> <span class="o">=</span> <span class="nx">entering</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">NODES</span><span class="p">].</span><span class="nx">slice</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">NODES</span><span class="p">].</span><span class="nx">length</span><span class="p">,</span> <span class="nx">data</span><span class="p">[</span><span class="nx">NODES</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="k">this</span><span class="p">[</span><span class="nx">NODES</span><span class="p">].</span><span class="nx">length</span><span class="p">));</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">entering</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_enter</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">exit</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">(),</span>
        <span class="nx">exiting</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">].</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span>
        <span class="nx">exiting</span> <span class="o">=</span> <span class="nx">exiting</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">].</span><span class="nx">splice</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">].</span><span class="nx">length</span><span class="p">,</span> <span class="k">this</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">data</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">].</span><span class="nx">length</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">NODES</span><span class="p">].</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">[</span><span class="nx">NODES</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span>
        <span class="nx">exiting</span> <span class="o">=</span> <span class="nx">exiting</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">NODES</span><span class="p">].</span><span class="nx">splice</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">NODES</span><span class="p">].</span><span class="nx">length</span><span class="p">,</span> <span class="k">this</span><span class="p">[</span><span class="nx">NODES</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">data</span><span class="p">[</span><span class="nx">NODES</span><span class="p">].</span><span class="nx">length</span><span class="p">));</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">exiting</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_exit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>ex.  grapher.update(); // updates all nodes and links
     grapher.update('links'); // updates only links
     grapher.update('nodes', 0, 4); // updates nodes indices 0 to 3 (4 is not inclusive)
     grapher.update('links', [0, 1, 2, 6, 32]); // updates links indexed by the indices</p></div></div><div class="code"><div class="wrapper">  <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">indices</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">start</span><span class="p">))</span> <span class="nx">indices</span> <span class="o">=</span> <span class="nx">start</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span><span class="p">(</span><span class="nx">start</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span><span class="p">(</span><span class="nx">end</span><span class="p">))</span> <span class="nx">indices</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">indices</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_addToUpdateQueue</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">indices</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">NODES</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addToUpdateQueue</span><span class="p">(</span><span class="nx">LINKS</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_findLinks</span><span class="p">(</span><span class="nx">indices</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">updateAll</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateAll</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">]</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">!==</span> <span class="nx">NODES</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">updateAll</span><span class="p">[</span><span class="nx">NODES</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateAll</span><span class="p">[</span><span class="nx">NODES</span><span class="p">]</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">!==</span> <span class="nx">LINKS</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Update an individual node by index.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">updateNode</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">willUpdateLinks</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_addToUpdateQueue</span><span class="p">(</span><span class="nx">NODES</span><span class="p">,</span> <span class="p">[</span><span class="nx">index</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">willUpdateLinks</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addToUpdateQueue</span><span class="p">(</span><span class="nx">LINKS</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_findLinks</span><span class="p">([</span><span class="nx">index</span><span class="p">]));</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Update an individual link by index.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">updateLink</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_addToUpdateQueue</span><span class="p">(</span><span class="nx">LINKS</span><span class="p">,</span> <span class="p">[</span><span class="nx">index</span><span class="p">]);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_update</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">stage</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">animate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">time</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">lastTime</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">lastTime</span> <span class="o">=</span> <span class="nx">time</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">lastTime</span> <span class="o">=</span> <span class="nx">time</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_frame</span> <span class="o">=</span> <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">play</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">pause</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_frame</span><span class="p">)</span> <span class="nx">cancelAnimationFrame</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_frame</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">resize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">resize</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">center</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">nodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">()</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">()[</span><span class="nx">NODES</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">numNodes</span> <span class="o">=</span> <span class="nx">nodes</span> <span class="o">?</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">numNodes</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// get initial transform</span>
      <span class="kd">var</span> <span class="nx">minX</span> <span class="o">=</span> <span class="kc">Infinity</span><span class="p">,</span> <span class="nx">maxX</span> <span class="o">=</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">,</span>
          <span class="nx">minY</span> <span class="o">=</span> <span class="kc">Infinity</span><span class="p">,</span> <span class="nx">maxY</span> <span class="o">=</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">,</span>
          <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">resolution</span><span class="p">,</span>
          <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">resolution</span><span class="p">,</span>
          <span class="nx">pad</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">,</span>
          <span class="nx">i</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">numNodes</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">minX</span><span class="p">)</span> <span class="nx">minX</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">maxX</span><span class="p">)</span> <span class="nx">maxX</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">minY</span><span class="p">)</span> <span class="nx">minY</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">maxY</span><span class="p">)</span> <span class="nx">maxY</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="kd">var</span> <span class="nx">dX</span> <span class="o">=</span> <span class="nx">maxX</span> <span class="o">-</span> <span class="nx">minX</span><span class="p">,</span>
          <span class="nx">dY</span> <span class="o">=</span> <span class="nx">maxY</span> <span class="o">-</span> <span class="nx">minY</span><span class="p">;</span>

      <span class="nx">scale</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">width</span> <span class="o">/</span> <span class="nx">dX</span><span class="p">,</span> <span class="nx">height</span> <span class="o">/</span> <span class="nx">dY</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nx">pad</span><span class="p">;</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">dX</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">minX</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">;</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">dY</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">minY</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">transform</span><span class="p">({</span><span class="nx">scale</span><span class="o">:</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">translate</span><span class="o">:</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]});</span>
  <span class="p">},</span>

  <span class="nx">transform</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">transform</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">transform</span><span class="p">))</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_transform</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_transform</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_transform</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">_transform</span> <span class="o">:</span> <span class="p">{},</span> <span class="nx">transform</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateTransform</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">backgroundColor</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">color</span><span class="p">))</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_backgroundColor</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_backgroundColor</span> <span class="o">=</span> <span class="nx">Color</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">color</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">setBackgroundColor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_backgroundColor</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">foregroundColor</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">color</span><span class="p">))</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_foregroundColor</span><span class="p">;</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">_foregroundColor</span> <span class="o">=</span> <span class="nx">Color</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">color</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">lineWidth</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">size</span><span class="p">))</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_lineWidth</span><span class="p">;</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">_lineWidth</span> <span class="o">=</span> <span class="nx">size</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">_exit</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">sprite</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">sprite</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">sprite</span><span class="p">);</span> <span class="p">},</span>
  <span class="nx">_enter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">from</span><span class="p">)</span> <span class="o">?</span> <span class="nx">NODES</span> <span class="o">:</span> <span class="nx">LINKS</span><span class="p">,</span>
        <span class="nx">sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">(</span><span class="nx">Grapher</span><span class="p">.</span><span class="nx">getTexture</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">foregroundColor</span><span class="p">()));</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">NODES</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">sprite</span><span class="p">.</span><span class="nx">interactive</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">sprite</span><span class="p">.</span><span class="nx">mouseover</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onEvent</span><span class="p">(</span><span class="nx">NODES</span><span class="p">,</span> <span class="s1">&#39;mouseover&#39;</span><span class="p">);</span>
      <span class="nx">sprite</span><span class="p">.</span><span class="nx">mouseout</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onEvent</span><span class="p">(</span><span class="nx">NODES</span><span class="p">,</span> <span class="s1">&#39;mouseout&#39;</span><span class="p">);</span>
      <span class="nx">sprite</span><span class="p">.</span><span class="nx">mousedown</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onEvent</span><span class="p">(</span><span class="nx">NODES</span><span class="p">,</span> <span class="s1">&#39;mousedown&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">[</span><span class="nx">type</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">sprite</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">_addToUpdateQueue</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">indices</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">insertIntoQueue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">atIndex</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sortedIndex</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">willUpdate</span><span class="p">[</span><span class="nx">type</span><span class="p">],</span> <span class="nx">i</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">willUpdate</span><span class="p">[</span><span class="nx">type</span><span class="p">][</span><span class="nx">atIndex</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">i</span><span class="p">)</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">willUpdate</span><span class="p">[</span><span class="nx">type</span><span class="p">].</span><span class="nx">splice</span><span class="p">(</span><span class="nx">atIndex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">updateAll</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">indices</span><span class="p">))</span> <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">indices</span><span class="p">,</span> <span class="nx">insertIntoQueue</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateAll</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateAll</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">willUpdate</span><span class="p">[</span><span class="nx">type</span><span class="p">].</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">[</span><span class="nx">type</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">_clearUpdateQueue</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">willUpdate</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">willUpdate</span><span class="p">[</span><span class="nx">NODES</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateAll</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateAll</span><span class="p">[</span><span class="nx">NODES</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateTransform</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">_update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">updatingLinks</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">willUpdate</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">],</span>
        <span class="nx">updatingNodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">willUpdate</span><span class="p">[</span><span class="nx">NODES</span><span class="p">],</span>
        <span class="nx">i</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateAll</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">])</span> <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">_updateLink</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">updatingLinks</span> <span class="o">&amp;&amp;</span> <span class="nx">updatingLinks</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">updatingLinks</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="nx">updatingLinks</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_updateLinkByIndex</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateAll</span><span class="p">[</span><span class="nx">NODES</span><span class="p">])</span> <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">NODES</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">_updateNode</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">updatingNodes</span> <span class="o">&amp;&amp;</span> <span class="nx">updatingNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">updatingNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="nx">updatingNodes</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_updateNodeByIndex</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateTransform</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">transform</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">transform</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">transform</span><span class="p">.</span><span class="nx">scale</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">,</span> <span class="nx">transform</span><span class="p">.</span><span class="nx">translate</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_clearUpdateQueue</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="nx">_updateLink</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">link</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">(),</span>
        <span class="nx">lw</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">lineWidth</span><span class="p">(),</span>
        <span class="nx">l</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">][</span><span class="nx">i</span><span class="p">],</span>
        <span class="nx">from</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">NODES</span><span class="p">][</span><span class="nx">l</span><span class="p">.</span><span class="nx">from</span><span class="p">],</span>
        <span class="nx">to</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">NODES</span><span class="p">][</span><span class="nx">l</span><span class="p">.</span><span class="nx">to</span><span class="p">],</span>
        <span class="nx">leftMost</span> <span class="o">=</span> <span class="nx">from</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">to</span><span class="p">.</span><span class="nx">x</span> <span class="o">?</span> <span class="nx">from</span> <span class="o">:</span> <span class="nx">to</span><span class="p">;</span>

    <span class="nx">link</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">from</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">from</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
    <span class="nx">link</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">lw</span><span class="p">;</span>
    <span class="nx">link</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">leftMost</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">leftMost</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">lw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="nx">link</span><span class="p">.</span><span class="nx">pivot</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">lw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="nx">link</span><span class="p">.</span><span class="nx">rotation</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">atan</span><span class="p">((</span><span class="nx">to</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">from</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">from</span><span class="p">.</span><span class="nx">x</span><span class="p">));</span>

    <span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">color</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">_findColor</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">color</span><span class="p">)</span> <span class="o">:</span>
        <span class="nx">Color</span><span class="p">.</span><span class="nx">interpolate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_findColor</span><span class="p">(</span><span class="nx">from</span><span class="p">.</span><span class="nx">color</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">_findColor</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">color</span><span class="p">));</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_setColor</span><span class="p">(</span><span class="nx">LINKS</span><span class="p">,</span> <span class="nx">link</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">_updateNode</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">()[</span><span class="nx">NODES</span><span class="p">][</span><span class="nx">i</span><span class="p">];</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">n</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">n</span><span class="p">.</span><span class="nx">r</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_setColor</span><span class="p">(</span><span class="nx">NODES</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_findColor</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">color</span><span class="p">));</span>
  <span class="p">},</span>

  <span class="nx">_updateNodeByIndex</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">_updateNode</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">NODES</span><span class="p">][</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">);</span> <span class="p">},</span>

  <span class="nx">_updateLinkByIndex</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">_updateLink</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">LINKS</span><span class="p">][</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">);</span> <span class="p">},</span>

  <span class="nx">_findLinks</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">indices</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">isLinked</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">indices</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">indices</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">flag</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">to</span> <span class="o">==</span> <span class="nx">indices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">||</span> <span class="nx">l</span><span class="p">.</span><span class="nx">from</span> <span class="o">==</span> <span class="nx">indices</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span> <span class="c1">// loose equivalience is sufficient</span>
              <span class="nx">flag</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">flag</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">links</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">()[</span><span class="nx">LINKS</span><span class="p">],</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">numLinks</span> <span class="o">=</span> <span class="nx">links</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">updatingLinks</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">numLinks</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isLinked</span><span class="p">(</span><span class="nx">indices</span><span class="p">,</span> <span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="nx">updatingLinks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">updatingLinks</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">_findColor</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="kc">NaN</span><span class="p">,</span>
        <span class="nx">palette</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">palette</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">palette</span> <span class="o">&amp;&amp;</span> <span class="nx">palette</span><span class="p">[</span><span class="nx">c</span><span class="p">])</span> <span class="nx">color</span> <span class="o">=</span> <span class="nx">palette</span><span class="p">[</span><span class="nx">c</span><span class="p">];</span>
    <span class="k">else</span> <span class="nx">color</span> <span class="o">=</span> <span class="nx">Color</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if color is still not set, use the default</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">color</span><span class="p">))</span> <span class="nx">color</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">foregroundColor</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">color</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">_setColor</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">sprite</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">texture</span> <span class="o">=</span> <span class="nx">Grapher</span><span class="p">.</span><span class="nx">getTexture</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>

    <span class="nx">sprite</span><span class="p">.</span><span class="nx">setTexture</span><span class="p">(</span><span class="nx">texture</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">_exit</span><span class="p">(</span><span class="nx">sprite</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_getBatch</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">color</span><span class="p">).</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">sprite</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">_getBatch</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">batches</span><span class="p">[</span><span class="nx">type</span><span class="p">][</span><span class="nx">color</span><span class="p">])</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">batch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PIXI</span><span class="p">.</span><span class="nx">SpriteBatch</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">LINKS</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">.</span><span class="nx">addChildAt</span><span class="p">(</span><span class="nx">batch</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">network</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">batch</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">batches</span><span class="p">[</span><span class="nx">type</span><span class="p">][</span><span class="nx">color</span><span class="p">]</span> <span class="o">=</span> <span class="nx">batch</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">batches</span><span class="p">[</span><span class="nx">type</span><span class="p">][</span><span class="nx">color</span><span class="p">];</span>
  <span class="p">},</span>

  <span class="nx">_onEvent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">type</span><span class="p">][</span><span class="nx">event</span><span class="p">]</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">type</span><span class="p">][</span><span class="nx">event</span><span class="p">]</span> <span class="o">:</span> <span class="nx">noop</span><span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">interaction</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">sprite</span> <span class="o">=</span> <span class="nx">interaction</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">sprite</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">getChildIndex</span><span class="p">(</span><span class="nx">sprite</span><span class="p">);</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">sprite</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">interaction</span><span class="p">);</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">module</span> <span class="o">&amp;&amp;</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">)</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Grapher</span><span class="p">;</span> <span class="c1">// export with module</span></div></div></div></div></body></html>